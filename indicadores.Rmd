---
title: "indicadores"
author: "Andrea Gomez Vargas"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(openxlsx)
```

```{r}
# EPH
pobreza <- read.xlsx("data/datos.xlsx", sheet = "pobreza")
estrato <- read.xlsx("data/datos.xlsx", sheet = "estrato")
ingresos  <- read.xlsx("data/datos.xlsx", sheet = "ingresos")

# CAPITAL HUMANO 
bess <- read.xlsx("data/datos.xlsx", sheet = "bess-1")

# CENSO 
salud  <- read.xlsx("data/datos.xlsx", sheet = "salud")
jubilacion <- read.xlsx("data/datos.xlsx", sheet = "jubilacion")
salud2 <- read.xlsx("data/datos.xlsx", sheet = "salud2")
```


## Censo


## EPH

```{r}



gpobreza <- pobreza %>% 
  select(1:2,5:6) %>% 
  pivot_longer(cols = c(3:4), names_to = "pobreza", values_to = "value") %>% 
  mutate(periodo =  paste0(anio, "-", semestre)) 


ggplot(gpobreza, aes(periodo, value, fill = pobreza)) +
  geom_col() +
  scale_fill_manual(values = c("#297373", "#e9d758")) +
  theme_bw() +
  theme(
    legend.position = "top"
  ) +
  coord_flip() +
  scale_x_discrete(limits=rev) +
  geom_text(aes(label = value, group = pobreza), 
            position = position_stack(vjust = 0.5), 
            size = 3, colour = "black") +
  labs(
    x = "periodo",
    y = "porcentaje",
    fill = "condición",
    title = "Distribución porcentual de las jubilaciones del sistema integrado previsional, \npor sexo y adhesión a moratoria. Total urbano. Años 2018-2013",
    caption = "Fuente: elaboración propia a partir de datos de Informe EPH - INDEC"
  )
  
```


## Capital Humano

```{r echo=FALSE, message=FALSE, warning=FALSE}
gbess <- bess %>% 
  filter(ano %in% c(2018:2023)) %>% 
  mutate(pp_con_v = round(con_moratoria_v/total_v*100,2),
         pp_sin_v = round(sin_moratoria_v/total_v*100,2),
         pp_con_m = round(con_moratoria_m/total_m*100,2),
         pp_sin_m = round(sin_moratoria_m/total_m*100,2)
         ) %>% 
  select(1, 8:11) %>% 
  pivot_longer(cols = c(2:5),names_to = "porcentaje", values_to = "value") %>% 
  mutate(sexo = case_when(porcentaje %in% c("pp_con_m","pp_sin_m") ~ "mujeres",
                          TRUE ~ "varones"),
         jubilacion =  case_when(porcentaje %in% c("pp_con_m","pp_con_v") ~ "con moratoria",
                          TRUE ~ "sin moratoria")
         )


ggplot(gbess, aes(sexo, value, fill = jubilacion))+
  geom_col() +
  facet_wrap(~ ano, nrow = 1) +
  #coord_flip() +
  #scale_fill_brewer(palette = "Set2") +
  scale_fill_manual(values = c("#297373", "#e9d758")) +
  theme_bw() +
  theme(
    legend.position = "top"
  ) +
  geom_text(aes(label = value, group = jubilacion), 
            position = position_stack(vjust = 0.5), 
            size = 3, colour = "black") +
  labs(
    x = " ",
    y = "porcentaje",
    fill = "percepción jubilatoria",
    title = "Distribución porcentual de las jubilaciones del sistema integrado previsional, \npor sexo y adhesión a moratoria. Total del país. Años 2018-2013",
    caption = "Fuente: elaboración propia a partir de datos del Boletín Estadístico de la Seguridad Social, Ministerio de Capital Humano"
  )
```

